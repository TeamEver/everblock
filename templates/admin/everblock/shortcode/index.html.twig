<div class="everblock-grid card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h3 class="card-title mb-0">{{ 'Shortcodes management'|trans({}, 'Modules.Everblock.Admin') }}</h3>
    <a class="btn btn-primary" href="{{ create_url }}">{{ 'Add new shortcode'|trans({}, 'Modules.Everblock.Admin') }}</a>
  </div>
  <div class="card-body">
    <form method="get" class="row g-2 mb-3">
      <div class="col-md-2">
        <label class="form-label">{{ 'ID'|trans({}, 'Modules.Everblock.Admin') }}</label>
        <input type="text" name="filters[id_everblock_shortcode]" value="{{ filters.id_everblock_shortcode|default('') }}" class="form-control" />
      </div>
      <div class="col-md-3">
        <label class="form-label">{{ 'Shortcode'|trans({}, 'Modules.Everblock.Admin') }}</label>
        <input type="text" name="filters[shortcode]" value="{{ filters.shortcode|default('') }}" class="form-control" />
      </div>
      <div class="col-md-3">
        <label class="form-label">{{ 'Title'|trans({}, 'Modules.Everblock.Admin') }}</label>
        <input type="text" name="filters[title]" value="{{ filters.title|default('') }}" class="form-control" />
      </div>
      <div class="col-md-4">
        <label class="form-label">{{ 'Content'|trans({}, 'Modules.Everblock.Admin') }}</label>
        <input type="text" name="filters[content]" value="{{ filters.content|default('') }}" class="form-control" />
      </div>
      <div class="col-12 d-flex gap-2">
        <button type="submit" class="btn btn-outline-secondary">{{ 'Filter'|trans({}, 'Modules.Everblock.Admin') }}</button>
        <a class="btn btn-link" href="{{ path('everblock_admin_shortcodes') }}">{{ 'Reset'|trans({}, 'Modules.Everblock.Admin') }}</a>
      </div>
    </form>

    <form method="post" id="everblock-shortcodes-bulk-form">
      <div class="table-responsive">
        <table class="table table-striped align-middle">
          <thead>
            <tr>
              <th><input type="checkbox" class="js-everblock-select-all"></th>
              {% for column in grid_definition.columns %}
                <th>{{ column.label }}</th>
              {% endfor %}
              <th class="text-end">{{ 'Actions'|trans({}, 'Modules.Everblock.Admin') }}</th>
            </tr>
          </thead>
          <tbody>
            {% for record in grid_data.records %}
              <tr>
                <td><input type="checkbox" name="ids[]" value="{{ record.id_everblock_shortcode }}"></td>
                {% for column in grid_definition.columns %}
                  <td>
                    {% set value = attribute(record, column.name) %}
                    {% if column.name == 'content' %}
                      {% set sanitized = value|striptags %}
                      {{ sanitized|length > 100 ? sanitized|slice(0, 100) ~ 'â€¦' : sanitized }}
                    {% else %}
                      {{ value }}
                    {% endif %}
                  </td>
                {% endfor %}
                <td class="text-end">
                  <div class="btn-group" role="group">
                    <a class="btn btn-outline-secondary btn-sm" href="{{ path(edit_route, {shortcodeId: record.id_everblock_shortcode}) }}">{{ 'Edit'|trans({}, 'Modules.Everblock.Admin') }}</a>
                    <button type="submit" class="btn btn-outline-danger btn-sm" formaction="{{ path(delete_route, {shortcodeId: record.id_everblock_shortcode}) }}" formmethod="post" data-confirm="{{ 'Are you sure you want to delete this shortcode?'|trans({}, 'Modules.Everblock.Admin') }}">{{ 'Delete'|trans({}, 'Modules.Everblock.Admin') }}</button>
                  </div>
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="{{ grid_definition.columns|length + 2 }}" class="text-center text-muted">{{ 'No shortcodes found.'|trans({}, 'Modules.Everblock.Admin') }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="d-flex gap-2 mt-3">
        <button type="submit" formaction="{{ bulk_delete_url }}" class="btn btn-danger" data-confirm="{{ grid_definition.bulk_actions.delete.confirm }}">{{ grid_definition.bulk_actions.delete.label }}</button>
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var toggle = document.querySelector('#everblock-shortcodes-bulk-form .js-everblock-select-all');
    if (toggle) {
      toggle.addEventListener('change', function (event) {
        document.querySelectorAll('#everblock-shortcodes-bulk-form input[name="ids[]"]').forEach(function (checkbox) {
          checkbox.checked = event.target.checked;
        });
      });
    }

    document.querySelectorAll('#everblock-shortcodes-bulk-form button[data-confirm]').forEach(function (button) {
      button.addEventListener('click', function (event) {
        var confirmMessage = button.getAttribute('data-confirm');
        if (confirmMessage && !confirm(confirmMessage)) {
          event.preventDefault();
        }
      });
    });
  });
</script>
